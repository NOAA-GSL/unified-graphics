{% extends "layouts/base.html" %}

{% block head %}
  {% if form.get("variable", None) -%}
    {%- set scriptname = "vectordiag.js" if form.variable == "uv" else "scalardiag.js" -%}
    <script type="module" src="{{ url_for('static', filename='js/' + scriptname) }}"></script>
  {%- endif %}
  <script type="module" src="{{ url_for('static', filename='js/diag.js') }}"></script>
{% endblock %}

{% block main -%}
{% for minim_loop in ["ges", "anl"] -%}
  <h2 class="heading-2 flex-0">{% if minim_loop == "ges" %}Guess{% else %}Analysis{% endif %}</h2>
  <div class="grid" style="--row-size: minmax(20rem, 1fr)">
    <chart-container class="padding-2 radius-md bg-white shadow-1">
      {% if form.variable == "uv" -%}
        <span class="axis-y title" slot="title-y">v (Observation &minus; Forecast)</span>
        <chart-2dhistogram id="distribution-{{ minim_loop }}" src="{{ dist_url[minim_loop] }}"></chart-2dhistogram>
        <span class="axis-x title" slot="title-x">u (Observation &minus; Forecast)</span>
        <color-ramp slot="legend" for="distribution-{{ minim_loop }}" class="font-ui-3xs" format="s"
          >Observation &minus; Forecast</color-ramp>
      {%- else -%}
        <span class="axis-y title" slot="title-y">Observation Count</span>
        <chart-histogram id="distribution-{{ minim_loop }}" src="{{ dist_url[minim_loop] }}"></chart-histogram>
        <span class="axis-x title" slot="title-x">Observation &minus; Forecast</span>
      {%- endif %}
    </chart-container>
    {% if form.variable != "uv" -%}
      <chart-container class="padding-2 radius-md bg-white shadow-1">
        <span class="axis-y title" slot="title-y">Observation &minus; Forecast</span>
        <chart-timeseries id="history-{{ minim_loop }}"></chart-timeseries>
        <span class="axis-x title" slot="title-x">Initialization Time</span>
      </chart-container>
    {%- endif %}
    <chart-container class="padding-2 radius-md bg-white shadow-1">
      <chart-map id="observations-{{ minim_loop }}"
        src="{{ map_url[minim_loop] }}"
        fill="properties.adjusted"></chart-map>
      <color-ramp slot="legend" for="observations-{{ minim_loop }}" class="font-ui-3xs" format="s"
        >Observation &minus; Forecast</color-ramp>
    </chart-container>
  </div>
{%- endfor %}

{% include "includes/model-dialog.html" %}

{%- endblock %}
