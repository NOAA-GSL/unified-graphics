{%- macro metadataSelect(name, label, options=[], current=None, reverse_sort=False) -%}
<p>
  <label for="{{ name }}">{{ label }}</label>
  <select id="{{ name }}" name="{{ name }}" {% if not options %} disabled{% endif %}>
    <option></option>
    {% for opt in options|sort(reverse_sort) -%}
    <option value="{{ opt }}" {% if opt==current or loop.length==1 %} selected{% endif %}>
      {{- opt -}}
    </option>
    {%- endfor %}
  </select>
</p>
{%- endmacro -%}

<header class="cluster justify padding-2">
  <div>
    <p>Unified Graphics</p>
    <h1>
      {%- if form.model -%}
      {{ form.model }} {{ form.initialization_time }}
      {%- else -%}
      Please Select a Model Run
      {%- endif -%}
    </h1>
    <p>{{ form.frequency }}</p>
    <dl>
      {% for meta in ["system", "domain", "background"] -%}
      <div>
        <dt>{{ meta }}</dt>
        <dd>{{ form[meta] or "None selected"}}</dd>
      </div>
      {% endfor -%}
    </dl>
  </div>
  <button onclick="document.getElementById('model-dialog').showModal()">Configure</button>
</header>

<dialog id="model-dialog">
  <h2>Select Data</h2>
  <form id="model-form" class="scrollable" method="GET">
    {{ metadataSelect("model", "Model", model_metadata.model_list, form.get("model", None))}}
    {{ metadataSelect("system", "System", model_metadata.system_list, form.get("system", None))}}
    {{ metadataSelect("domain", "Domain", model_metadata.domain_list, form.get("domain", None))}}
    {{ metadataSelect("frequency", "Frequency", model_metadata.frequency_list, form.get("frequency", None))}}
    {{ metadataSelect("background", "Background", model_metadata.background_list, form.get("background", None))}}
    {{ metadataSelect("initialization_time", "Initialization_time", model_metadata.init_time_list,
    form.get("initialization_time", None), True)}}
    {{ metadataSelect("variable", "Variable", model_metadata.variable_list, form.get("variable", None))}}

    <label>
      {%- set checked = " checked" if form.is_used else "" -%}
      <input type="checkbox" name="is_used" {{ checked }} />
      Include unused observations
    </label>

  </form>
  <button form="model-form">Load</button>
</dialog>

{% if show_dialog -%}
<script>document.getElementById("model-dialog").showModal()</script>
{%- endif %}
